<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Shyam Ads Agency — Ads Manager</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap');
    :root{
      --meta-blue: #1877F2;
      --meta-dark: #001D35;
    }
    body { font-family: 'Inter', sans-serif; transition: margin-left .25s ease; }
    /* Status dot helpers */
    .dot-green { background-color: #10B981; }
    .dot-yellow { background-color: #F59E0B; }
    .dot-blue { background-color: #3B82F6; }
    .dot-gray { background-color: #6B7280; }

    /* Table container horizontal scroll */
    .table-container { overflow-x: auto; }

    /* Sorting icons (tiny triangles using borders) */
    .sort-icon { display:inline-block; width:0; height:0; margin-left:.5rem; vertical-align:middle; }
    .sort-asc { border-left:4px solid transparent; border-right:4px solid transparent; border-bottom:6px solid currentColor; }
    .sort-desc { border-left:4px solid transparent; border-right:4px solid transparent; border-top:6px solid currentColor; }
    .sort-inactive { color:#cbd5e1; } /* tailwind gray-300 */
  </style>
</head>
<body class="bg-gray-100 min-h-screen">

  <div id="app"></div>

<script>
/*************************************************************************
 * Shyam Ads Agency — Ads Manager (single-file corrected demo)
 * - fixes missing helpers, completes tables, adds handlers
 * - uses mock data and localStorage
 *************************************************************************/

// ---------- MOCK DATA ----------
const MOCK_DATA = {
  statCards: [
    { title: 'Total Spend', value: '$20,151.45', change: '+5.2% vs last 30 days' },
    { title: 'Total Reach', value: '720,000', change: '+2.1% vs last 30 days' },
    { title: 'Impressions', value: '2,230,000', change: '+3.5% vs last 30 days' },
    { title: 'Total Leads', value: '2,500', change: '-1.8% vs last 30 days' },
  ],
  campaigns: [
    { id: 1, name: 'Summer Sale 2024 - Awareness', status: 'active', objective: 'Reach', budget: 5000, spend: 3200.50, results: '1,200,500', reach: 450000, impressions: 1200000, cpr: 2.67, ends: '2024-12-31' },
    { id: 2, name: 'New Product Launch - Q4 Leads', status: 'active', objective: 'Leads', budget: 10000, spend: 8500.75, results: '2,500 Leads', reach: 120000, impressions: 300000, cpr: 3.40, ends: '2025-01-15' },
    { id: 3, name: 'Brand Awareness - West Coast', status: 'paused', objective: 'Awareness', budget: 2000, spend: 1000.00, results: '500,000', reach: 50000, impressions: 150000, cpr: 2.00, ends: '2024-11-30' },
    { id: 4, name: 'Lead Gen - Ebook Download', status: 'draft', objective: 'Leads', budget: 1500, spend: 0, results: '0', reach: 0, impressions: 0, cpr: 0, ends: 'N/A' },
  ],
  adSets: [],
  ads: [],
  audiences: [],
  invoices: [],
};

// ---------- State ----------
const STORAGE_KEY = 'shyam_ads_state_v1';
function getInitialState(){
  const persisted = localStorage.getItem(STORAGE_KEY);
  if(persisted){
    try { return JSON.parse(persisted); } catch(e){}
  }
  return {
    isLoggedIn: false,
    username: '',
    showPassword: false,
    showOtp: false,
    otp: '',
    currentView: 'dashboard', // dashboard, campaigns, adsets, ads, audiences, billing
    sidebarOpen: window.innerWidth >= 1024,
    campaigns: MOCK_DATA.campaigns.slice(),
    adSets: MOCK_DATA.adSets.slice(),
    ads: MOCK_DATA.ads.slice(),
    audiences: MOCK_DATA.audiences.slice(),
    statCards: MOCK_DATA.statCards.slice(),
    invoices: MOCK_DATA.invoices.slice(),
    // UI helpers
    campaignSearch: '',
    adsetSearch: '',
    adSearch: '',
    audienceSearch: '',
    campaignSort: { key: 'id', dir: 'desc' },
    adsetSort: { key: 'id', dir: 'desc' },
    adSort: { key: 'id', dir: 'desc' },
    audienceSort: { key: 'id', dir: 'desc' },
    wizardVisible: false,
    wizardStep: 1,
    wizardData: {
      objective: 'Awareness',
      campaignName: 'New Campaign - ' + new Date().toISOString().slice(0,10),
      budgetType: 'daily',
      amount: 100,
      adSetName: 'New Ad Set',
      location: 'United States',
      age: '18 - 65+',
      platform: 'Facebook & Instagram',
      creativeName: 'New Ad - Image',
      headline: 'Limited Time Offer!',
      cta: 'Shop Now',
    }
  };
}
let state = getInitialState();

function persistState(){
  try { localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); } catch(e){}
}

// ---------- Utilities ----------
function escapeHtml(str) {
  if (str === undefined || str === null) return '';
  return String(str)
    .replace(/&/g, "&amp;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;")
    .replace(/"/g, "&quot;")
    .replace(/'/g, "&#039;");
}

function iconSVG(name, size = 18, cls=''){
  const icons = {
    Menu: `<line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/>`,
    Layout: `<path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/>`,
    Megaphone: `<path d="M12 10H6c-3.3 0-6 2.7-6 6v2c0 3.3 2.7 6 6 6h6l-2-2m-4-2c0 1.1-.9 2-2 2s-2-.9-2-2 .9-2 2-2 2 .9 2 2zM12 4l9 9-4 4-9-9 4-4z"/>`,
    Search: `<circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/>`,
    Lock: `<rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/>`,
    Mail: `<rect x="2" y="4" width="20" height="16" rx="2"/><path d="m22 7-10 7L2 7"/>`,
    Eye: `<path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7z"/><circle cx="12" cy="12" r="3"/>`,
    EyeOff: `<path d="M17.94 17.94A10.07 10.07 0 0 1 12 18c-7 0-10-7-10-7a1.69 1.69 0 0 1 0-.11"/><path d="M12 12c-1.3 0-2.6-.4-3.7-1.1"/><path d="M6 6.05A10.07 10.07 0 0 1 12 6c7 0 10 7 10 7a1.69 1.69 0 0 1 0 .11"/><line x1="2" y1="2" x2="22" y2="22"/>`,
    Plus: `<circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="16"/><line x1="8" y1="12" x2="16" y2="12"/>`,
    User: `<path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/>`,
    Bell: `<path d="M18.8 17.5a2 2 0 0 1-1.4.5H6.6a2 2 0 0 1-1.4-.5L2 12V6l2-2h16l2 2v6z"/><path d="M10 22h4"/>`,
    ChevronDown: `<polyline points="6 9 12 15 18 9"/>`,
    X: `<line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>`,
  };
  const path = icons[name] || icons.Search;
  return `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="${cls}">${path}</svg>`;
}

function formatCurrency(amount){
  if (typeof amount !== 'number') return amount;
  return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(amount);
}

function renderStatusBadge(status){
  // simple deterministic mapping, keep tailwind safe classes
  const config = {
    active: { label: 'Active', dot: 'dot-green', bg: 'bg-green-100 text-green-800' },
    paused: { label: 'Paused', dot: 'dot-yellow', bg: 'bg-yellow-100 text-yellow-800' },
    draft: { label: 'Draft', dot: 'dot-blue', bg: 'bg-blue-100 text-blue-800' },
    completed: { label: 'Completed', dot: 'dot-gray', bg: 'bg-gray-100 text-gray-800' },
    Ready: { label: 'Ready', dot: 'dot-green', bg: 'bg-green-100 text-green-800' },
    Populating: { label: 'Populating', dot: 'dot-blue', bg: 'bg-blue-100 text-blue-800' }
  };
  const cfg = config[status] || { label: status, dot: 'dot-gray', bg: 'bg-gray-100 text-gray-800' };
  return `<span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium ${cfg.bg}"><span class="h-2 w-2 mr-2 rounded-full ${cfg.dot}"></span>${escapeHtml(cfg.label)}</span>`;
}

// ---------- Sorting helper ----------
function sortIcon(view, key) {
  const sortState = {
    campaigns: state.campaignSort,
    adsets: state.adsetSort,
    ads: state.adSort,
    audiences: state.audienceSort
  }[view];

  if (!sortState) return '';

  const active = sortState.key === key;
  const dir = sortState.dir;

  const className = "sort-icon " + (active ? "" : "sort-inactive");

  if (!active) return `<span class="${className} sort-asc"></span>`;

  return dir === 'asc'
    ? `<span class="${className} sort-asc"></span>`
    : `<span class="${className} sort-desc"></span>`;
}

// ---------- Rendering ----------
function render(){
  const root = document.getElementById('app');
  root.innerHTML = `
    <div class="min-h-screen flex flex-col lg:flex-row">
      ${renderSidebar()}
      <div class="flex-1 p-6">
        ${renderHeader()}
        <main class="mt-6">
          ${renderView()}
        </main>
      </div>
    </div>
    ${state.wizardVisible ? renderWizardModal() : ''}
  `;
  attachGlobalHandlers();
}

function renderSidebar(){
  return `
    <aside class="bg-white border-r border-gray-200 ${state.sidebarOpen ? 'w-64' : 'w-16'} transition-all duration-200 shrink-0">
      <div class="h-full flex flex-col">
        <div class="flex items-center justify-between px-4 py-4 border-b border-gray-100">
          <div class="flex items-center space-x-2">
            <div class="bg-meta-blue text-white font-bold rounded-md ${state.sidebarOpen ? 'px-3 py-2' : 'p-2'}">${state.sidebarOpen ? 'Shyam Ads Agency' : 'S'}</div>
          </div>
          <button id="toggle-sidebar" class="text-gray-500 hover:text-gray-700">
            ${iconSVG('Menu', 18)}
          </button>
        </div>

        <nav class="flex-1 px-2 py-4 space-y-1 overflow-auto">
          ${sideItem('dashboard', 'Dashboard', 'Layout')}
          ${sideItem('campaigns', 'Campaigns', 'Megaphone')}
          ${sideItem('adsets', 'Ad Sets', 'Layout')}
          ${sideItem('ads', 'Ads', 'Layout')}
          ${sideItem('audiences', 'Audiences', 'User')}
          ${sideItem('billing', 'Billing', 'Mail')}
        </nav>

        <div class="p-4 border-t border-gray-100">
          <div class="flex items-center justify-between">
            <div class="text-sm text-gray-600">
              ${state.isLoggedIn ? `Signed in as <strong>${escapeHtml(state.username)}</strong>` : 'Not signed in'}
            </div>
            <div>
              ${state.isLoggedIn ? `<button id="logout-btn" class="text-sm text-red-600">Log out</button>` : ''}
            </div>
          </div>
        </div>
      </div>
    </aside>
  `;
}

function sideItem(view, label, iconName){
  const activeClass = state.currentView === view ? 'bg-gray-100 text-meta-blue rounded-md' : 'text-gray-700 hover:bg-gray-50';
  return `
    <button data-view="${view}" class="w-full flex items-center space-x-3 px-3 py-2 ${activeClass}">
      <div class="w-6 h-6">${iconSVG(iconName, 18)}</div>
      ${ state.sidebarOpen ? `<div class="text-sm font-medium">${label}</div>` : '' }
    </button>
  `;
}

function renderHeader(){
  return `
    <div class="flex items-center justify-between">
      <div class="flex items-center space-x-4">
        <button id="open-wizard" class="inline-flex items-center px-4 py-2 bg-meta-blue text-white rounded-lg hover:opacity-95 shadow">
          ${iconSVG('Plus', 16)} <span class="ml-2">Create Campaign</span>
        </button>

        <div class="hidden md:flex items-center bg-white border border-gray-200 rounded-lg px-3 py-2">
          ${iconSVG('Search', 18)}
          <input id="global-search" placeholder="Search campaigns, ads, audiences..." class="ml-3 w-64 focus:outline-none" />
        </div>
      </div>

      <div class="flex items-center space-x-4">
        <div class="text-sm text-gray-600">Shyam Ads Agency</div>
        <button id="toggle-sidebar-top" class="p-2 rounded-full hover:bg-gray-100">${iconSVG('Menu')}</button>
      </div>
    </div>
  `;
}

function renderView(){
  if(!state.isLoggedIn) return renderLogin();
  switch(state.currentView){
    case 'dashboard': return renderDashboard();
    case 'campaigns': return renderCampaignsView();
    case 'adsets': return renderAdSetsView();
    case 'ads': return renderAdsView();
    case 'audiences': return renderAudiencesView();
    case 'billing': return renderBillingView();
    default: return renderDashboard();
  }
}

// ---------- Login ----------
function renderLogin(){
  return `
    <div class="max-w-md mx-auto bg-white rounded-xl shadow p-8">
      <div class="text-center mb-6">
        <h1 class="text-2xl font-bold text-meta-blue">Shyam Ads Manager</h1>
        <p class="text-sm text-gray-500 mt-1">Sign in to manage campaigns. (Demo credentials below)</p>
      </div>

      <div class="bg-blue-50 p-3 rounded border border-blue-100 text-sm text-blue-700 mb-4">
        Demo: user <strong>admin</strong> | pass <strong>password123</strong> | OTP <strong>123456</strong>
      </div>

      <form id="login-form" class="space-y-4">
        <div>
          <label class="text-sm font-medium text-gray-700">Username</label>
          <div class="relative">
            ${iconSVG('Mail',16,'absolute left-3 top-3 text-gray-400')}
            <input id="username" class="pl-10 pr-3 py-2 w-full border rounded" value="${escapeHtml(state.username || '')}" />
          </div>
        </div>

        <div>
          <label class="text-sm font-medium text-gray-700">Password</label>
          <div class="relative">
            ${iconSVG('Lock',16,'absolute left-3 top-3 text-gray-400')}
            <input id="password" type="${state.showPassword ? 'text' : 'password'}" class="pl-10 pr-10 py-2 w-full border rounded" value="" placeholder="password123" />
            <button type="button" id="toggle-pw" class="absolute right-3 top-2 text-gray-500">${iconSVG(state.showPassword ? 'EyeOff' : 'Eye',16)}</button>
          </div>
        </div>

        <div id="login-error" class="hidden text-sm text-red-600"></div>

        <div>
          <button id="sign-in-btn" class="w-full px-4 py-2 bg-meta-blue text-white rounded">Sign In & Send OTP</button>
        </div>
      </form>

      ${state.showOtp ? `
        <form id="otp-form" class="mt-4 space-y-3">
          <label class="text-sm font-medium text-gray-700">Enter OTP</label>
          <input id="otp-input" class="w-full border rounded py-2 px-3 text-center" placeholder="123456" maxlength="6" />
          <div class="flex space-x-2">
            <button id="verify-otp" class="flex-1 px-4 py-2 bg-green-600 text-white rounded">Verify & Log In</button>
            <button id="back-to-login" class="flex-1 px-4 py-2 bg-gray-100 rounded">Back</button>
          </div>
        </form>
      ` : ''}
    </div>
  `;
}

// ---------- Dashboard ----------
function renderDashboard(){
  return `
    <div>
      <h2 class="text-xl font-semibold text-gray-800">Overview</h2>

      <div class="mt-5 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
        ${state.statCards.map(c => `
          <div class="bg-white p-4 rounded-lg border border-gray-200">
            <div class="text-sm text-gray-500">${c.title}</div>
            <div class="mt-2 text-2xl font-bold text-gray-800">${c.value}</div>
            <div class="mt-1 text-sm text-gray-500">${c.change}</div>
          </div>
        `).join('')}
      </div>

      <div class="mt-6">
        <h3 class="text-lg font-medium text-gray-800">Active Campaigns</h3>
        <div class="mt-3 bg-white p-4 rounded-lg border border-gray-200">
          ${renderCampaignsTablePreview()}
        </div>
      </div>
    </div>
  `;
}

function renderCampaignsTablePreview(){
  const rows = state.campaigns.slice(0,4).map(c => `
    <tr class="border-b">
      <td class="py-2">${c.id}</td>
      <td class="py-2 font-medium">${escapeHtml(c.name)}</td>
      <td class="py-2">${renderStatusInline(c.status)}</td>
      <td class="py-2">${escapeHtml(c.objective)}</td>
      <td class="py-2">${formatCurrency(c.budget)}</td>
      <td class="py-2">${formatCurrency(c.spend)}</td>
    </tr>
  `).join('');
  return `
    <div class="table-container">
      <table class="w-full text-left">
        <thead class="text-xs text-gray-500">
          <tr><th class="pb-3">ID</th><th class="pb-3">Name</th><th class="pb-3">Status</th><th class="pb-3">Objective</th><th class="pb-3">Budget</th><th class="pb-3">Spend</th></tr>
        </thead>
        <tbody>${rows}</tbody>
      </table>
    </div>
  `;
}

function renderStatusInline(status){
  const map = { active: 'dot-green', paused: 'dot-yellow', draft: 'dot-blue', Ready: 'dot-green', Populating: 'dot-blue' };
  const dot = map[status] || 'dot-gray';
  const label = status;
  return `<span class="inline-flex items-center space-x-2 text-sm"><span class="h-2 w-2 rounded-full ${dot}"></span><span class="capitalize">${escapeHtml(label)}</span></span>`;
}

// ---------- Campaigns view ----------
function renderCampaignsView(){
  return `
    <div>
      <div class="flex items-center justify-between">
        <h2 class="text-xl font-semibold">Campaigns</h2>
        <div class="flex items-center space-x-2">
          <input id="campaign-search" value="${escapeHtml(state.campaignSearch)}" placeholder="Search campaigns..." class="border rounded px-3 py-2" />
          <button id="new-campaign" class="px-3 py-2 bg-meta-blue text-white rounded">New Campaign</button>
        </div>
      </div>

      <div class="mt-4 bg-white rounded border p-4">
        <div class="table-container">
          <table class="w-full">
            <thead class="text-xs text-gray-500 uppercase">
              <tr>
                <th class="text-left py-2 cursor-pointer" data-sort-key="id">ID ${sortIcon('campaigns','id')}</th>
                <th class="text-left py-2 cursor-pointer" data-sort-key="name">Name ${sortIcon('campaigns','name')}</th>
                <th class="text-left py-2">Status</th>
                <th class="text-left py-2">Objective</th>
                <th class="text-left py-2 cursor-pointer" data-sort-key="budget">Budget ${sortIcon('campaigns','budget')}</th>
                <th class="text-left py-2">Spend</th>
                <th class="text-left py-2">Reach</th>
                <th class="text-left py-2">Impressions</th>
                <th class="text-left py-2">CPR</th>
                <th class="text-left py-2">Ends</th>
              </tr>
            </thead>
            <tbody>
              ${renderCampaignRows()}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  `;
}

function renderCampaignRows(){
  const q = state.campaignSearch.trim().toLowerCase();
  let rows = state.campaigns.slice();

  if(q){
    rows = rows.filter(c => (c.name || '').toLowerCase().includes(q) || (c.objective || '').toLowerCase().includes(q));
  }

  // sorting
  const sort = state.campaignSort || { key: 'id', dir: 'desc' };
  rows.sort((a,b) => {
    const k = sort.key;
    let va = a[k], vb = b[k];
    if (typeof va === 'string') va = va.toLowerCase();
    if (typeof vb === 'string') vb = vb.toLowerCase();
    if (va == vb) return 0;
    const res = va > vb ? 1 : -1;
    return sort.dir === 'asc' ? res : -res;
  });

  return rows.map(c => `
    <tr class="border-b hover:bg-gray-50">
      <td class="py-2">${c.id}</td>
      <td class="py-2 font-medium">${escapeHtml(c.name)}</td>
      <td class="py-2">${renderStatusBadge(c.status)}</td>
      <td class="py-2">${escapeHtml(c.objective)}</td>
      <td class="py-2">${formatCurrency(c.budget)}</td>
      <td class="py-2">${formatCurrency(c.spend)}</td>
      <td class="py-2">${escapeHtml(String(c.reach))}</td>
      <td class="py-2">${escapeHtml(String(c.impressions))}</td>
      <td class="py-2">${escapeHtml(String(c.cpr))}</td>
      <td class="py-2">${escapeHtml(c.ends)}</td>
    </tr>
  `).join('');
}

// ---------- Additional Views (simple placeholders) ----------
function renderAdSetsView(){
  return `<div><h2 class="text-xl font-semibold">Ad Sets</h2><p class="text-sm text-gray-500 mt-2">Placeholder view.</p></div>`;
}
function renderAdsView(){
  return `<div><h2 
<html>
  <head>
    <title>Hello, World!</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
      <h1 class="title">Hello World! </h1>
      <p id="currentTime"></p>
      <script src="script.js"></script>
  </body>
</html>